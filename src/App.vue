<template>


    <!-- È°∂ÈÉ®ÁöÑ Settings Ê®°Âùó -->
    <div class="module" id="settings">

        <div class="settings-module">
            <h2>Setting:</h2>
            <!-- Filter by Angles -->
            <div class="setting-group">
                <div class="angles-container">
                    <h3>Filter by Angles:</h3>
                    <div v-for="angle in angles" :key="angle.subtheme_id"
                        :class="['color-tag', { selected: angle.selected }]" :style="{ backgroundColor: angle.color }"
                        @click="toggleAngleSelection(angle)"></div>
                </div>
            </div>

            <!-- Filter by Status -->
            <div class="setting-group">
                <div class="filter-status">
                    <h3>Filter by Status:</h3>
                    <select class="dropdown" v-model="filterStatus">
                        <option value="all">All</option>
                        <option value="unread">Unread</option>
                        <option value="read">Read</option>
                    </select>
                </div>
            </div>

            <!-- Sort Articles -->
            <div class="setting-group">
                <div class="sort-options">
                    <h3>Sort Articles:</h3>
                    <select class="dropdown" v-model="sortOrder">
                        <option value="publishedAt">By Published Time</option>
                        <option value="angleCategoryCount">By Number of Angle Categories   </option>
                        <option value="recommendationScore">By Angular Importance</option>
                        <option value="repetitionRate">By Similarity</option>
                        <option value="comprehensiveScore">By Composite Score</option>
                    </select>
                </div>
            </div>

            <!-- Weight Settings -->
            <div class="setting-group">
                <div class="weight-settings">
                    <h3>Weight Settings:</h3>
                    <div class="weight-slider">
                        <label>
                            <span>‚≠ê Angular Importance Weight:</span> {{ weights.recommendation.toFixed(2) }}
                        </label>
                        <input type="range" min="0" max="1" step="0.1" v-model.number="weights.recommendation"
                            @input="updateComprehensiveScores" />
                        <label>
                            <span>üîÅ Similarity Weight:</span> {{ (1 - weights.recommendation).toFixed(2) }}
                        </label>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!-- ‰∏≠Èó¥ÈÉ®ÂàÜÔºö‰∏âÂàóÂ∏ÉÂ±Ä -->
    <div id="main-content">
        <!-- Â∑¶‰æßÁöÑ Articles Ê®°Âùó -->
        <div class="module" id="article-list">
            <h2>Articles</h2>
            <div v-for="article in filteredAndSortedArticles" :key="article.id" class="article-card"
                :id="'article-' + article.id"
                @click="logDebug('Clicked article card: ' + article.id); showArticle(article, article.id)"
                @mouseover="highlightConnection(article.id, null)" @mouseout="removeHighlight()"
                :class="{ read: article.isRead, 'active': selectedArticleId === `${article.id}` }">

                <!-- ÊñáÁ´†Ê†áÈ¢ò -->
                <div class="article-title">{{ article.title }}</div>

                <!-- ÂèëÂ∏ÉÊó∂Èó¥ -->
                <div class="article-meta">
                    <span v-if="article.publishedAt"> üìÖ {{ formatPublishedAt(article.publishedAt) }}</span>
                    <span v-if="article.domain">üåê {{ article.domain }}</span>
                </div>
                <div class="article-meta">
                    <span v-if="article.recommendationScore !== undefined">
                        ‚≠ê Angular Importance: {{ article.recommendationScore.toFixed(2) }}
                    </span>
                    <span v-if="!article.isRead && article.repetitionRate !== null && !isNaN(article.repetitionRate)">
                        üîÅ Similarity : {{ article.repetitionRate != null && !isNaN(article.repetitionRate) ?
                            article.repetitionRate.toFixed(2) : 'N/A' }}
                    </span>
                </div>
                <div class="article-meta">
                    <span
                        v-if="!article.isRead && article.comprehensiveScore !== null && !isNaN(article.comprehensiveScore)">
                        üèÜ Composite Score: {{ article.comprehensiveScore != null &&
                            !isNaN(article.comprehensiveScore) ?
                            article.comprehensiveScore.toFixed(2) : 'N/A' }}
                    </span>
                    <span>
                        <input type="checkbox" v-model="article.isRead" @change="handleReadStatusChange(article)" />
                        Mark as Read
                    </span>
                </div>


                <div class="bar-chart">
                    <div v-for="(color, index) in article.paragraphColors" :key="index" class="bar"
                        :style="{ width: calculateBarWidth(article.paragraphs[index].wordCount) + 'px', backgroundColor: color }"
                        @click.stop="logDebug('Clicked paragraph bar: Article ID: ' + article.id + ', Paragraph Index: ' + index); scrollToParagraph(article.id, index)">
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏≠Èó¥ÁöÑÈÄâÈ°πÂç°ÂàáÊç¢Ê®°Âùó -->
        <div id="analysis-paragraph-tabs" class="module">
            <h2>
                <button @click="setActiveTab('analysisAngles')" :class="{ active: activeTab === 'analysisAngles' }">
                    Analysis Angles
                </button>
                <button @click="setActiveTab('paragraphComparison')"
                    :class="{ active: activeTab === 'paragraphComparison' }">
                    Paragraph Comparison
                </button>
            </h2>
            <div v-if="activeTab === 'analysisAngles'">
                <!-- Analysis Angles Module -->
                <div id="analysis-angles">

                    <button @click="toggleHideUnmatchedBars" class="toggle-button">
                        {{ hideUnmatchedBars ? 'Show All Bars' : 'Hide Unmatched Bars' }}
                    </button>

                    <button @click="toggleConnectionsVisibility" class="toggle-button">
                        {{ connectionsVisible ? 'Hide All Connections' : 'Show All Connections' }}
                    </button>

                    <!-- ÊäòÂè†ÂíåÂ±ïÂºÄÊâÄÊúâÊëòË¶ÅÊåâÈíÆ -->
                    <button @click="toggleAllSummaries" class="toggle-button">
                        {{ allSummariesExpanded ? 'Collapse All Summaries' : 'Expand All Summaries' }}
                    </button>

                    <!-- ÊäòÂè†ÂíåÂ±ïÂºÄÊâÄÊúâ Bars ÊåâÈíÆ -->
                    <button @click="toggleAllBars" class="toggle-button">
                        {{ allBarsExpanded ? 'Collapse All Bars' : 'Expand All Bars' }}
                    </button>



                    <!-- Êõ≤Á∫øÁªòÂà∂ -->
                    <svg id="connection-lines" width="100%" height="100%"
                        style="position: absolute; top: 0; left: 0; z-index: 9;"></svg>

                    <!-- <h2>Analysis Angles</h2> -->
                    <draggable v-model="angles" itemKey="subtheme_id" @end="onAngleSortEnd" group="angles"
                        class="angles-list">

                        <template #item="{ element }">
                            <div :class="['analysis-angle', { expanded: element.expanded }]"
                                :style="{ borderLeft: `5px solid ${element.color}` }">
                                <span class="drag-handle" style="cursor: grab; margin-right: 10px;">‚†ø</span>


                                <button style="margin-right: 5px;" class="toggle-button summary-button"
                                    @click="toggleSummary(element)">
                                    <span v-if="element.expandedSummary">‚ñ≤ Hide Summary</span>
                                    <span v-else>‚ñº Show Summary</span>
                                </button>
                                <button class="toggle-button bars-button" @click="toggleBars(element)">
                                    <span v-if="element.expandedBars">‚ñ≤ Hide Bars</span>
                                    <span v-else>‚ñº Show Bars</span>
                                </button>

                                <span class="angle-paragraph-count">{{ element.paragraphCount }}</span>
                                <h3 style="margin: 5px 0;">{{ element.title }}</h3>

                                <!-- ÊëòË¶ÅÈÉ®ÂàÜ -->
                                <div class="angle-summary">
                                    <p class="summary-content" v-if="element.expandedSummary">{{ element.merged_content
                                        }}</p>
                                </div>

                                <!-- Â≠óÊï∞Êü±Áä∂ÂõæÈÉ®ÂàÜ -->
                                <div class="word-count-bar-chart-container">
                                    <div class="word-count-bar-chart"
                                        v-if="element.expandedBars && element.paragraphs.length">
                                        <div v-for="(paragraph, index) in filteredParagraphs(element.paragraphs)"
                                            :key="index" class="bar-container" :data-article-id="paragraph.article_id"
                                            :data-paragraph-index="paragraph.paragraph_index">
                                            <div class="bar" :style="{
                                                width: calculateBarWidth(paragraph.wordCount) + 'px',
                                                backgroundColor: element.color,
                                            }" @mouseover="highlightConnection(paragraph.article_id, paragraph.paragraph_index)"
                                                @mouseout="removeHighlight()"
                                                @click="scrollToParagraph(paragraph.article_id, paragraph.paragraph_index - 1)">
                                            </div>
                                            <span class="word-count-label">characters:{{ paragraph.wordCount }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </draggable>
                </div>
            </div>
            <div v-else-if="activeTab === 'paragraphComparison'">
                <div id="paragraph-comparison">
                    <!-- <h2>Paragraph Comparison</h2> -->
                    <!-- ÂΩìÂâçËßíÂ∫¶ÂêçÁß∞ -->
                    <div v-if="selectedParagraphAngle">
                        <h3 class="current-angle-title">Current Angle: {{ selectedParagraphAngle.title }}</h3>
                    </div>
                    <svg id="connection-lines" width="100%" height="100%"
                        style="position: absolute; top: 0; left: 0; z-index: 9;"></svg>


                    <div v-if="selectedParagraphSimilarities.length">
                        <!-- Êü±Áä∂Âõæ -->
                        <span class="similarity-label">similarity:</span>
                        <div v-for="(similarity, index) in selectedParagraphSimilarities" :key="index"
                            class="bar-container" :data-article-id="similarity.articleId"
                            :data-paragraph-index="similarity.paragraphIndex">
                            <div class="bar" :style="{
                                height: '20px',
                                width: calculateBarWidth(similarity.wordCount) * 1.5 + 'px',
                                backgroundColor: getBarColor(similarity.paragraph), // ÊÆµËêΩÊâÄÂ±ûËßíÂ∫¶ÁöÑÈ¢úËâ≤
                                opacity: getBarOpacity(similarity.similarity) // Ê†πÊçÆÁõ∏‰ººÂ∫¶Ë∞ÉÊï¥ÈÄèÊòéÂ∫¶
                            }" @mouseover="highlightConnection(similarity.articleId, similarity.paragraphIndex)"
                                @mouseout="removeHighlight()"
                                @click="showSimilarParagraph(similarity.paragraph, similarity.articleId, similarity.paragraphIndex, similarity.originalparagraphKey)">

                                <span class="similarity-label">{{ similarity.similarity.toFixed(2) }}</span>
                            </div>
                            <!-- Âú®Êü±Áä∂ÂùóÈáåÊòæÁ§∫Áõ∏‰ººÂ∫¶ÔºåÊóÅÊòæÁ§∫Â≠óÊï∞ -->
                            <span class="similarity-label">characters:{{ similarity.wordCount }}</span>
                        </div>
                    </div>
                    <div v-else>
                        <p>Select a paragraph to see similar paragraphs.</p>
                    </div>
                    <!-- ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊÆµËêΩ -->
                    <div v-if="selectedSimilarParagraph">
                        <h3>Selected Paragraph:</h3>
                        <p :id="'paragraph-' + selectedSimilarParagraph.articleId + '-' + selectedSimilarParagraph.paragraphIndex"
                            v-html="formatParagraphContent(selectedSimilarParagraph.content)"></p>
                    </div>
                    <div v-else>
                        <p>Select a paragraph to see paragraph content.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂèØÊãñÊãΩÁöÑÂàÜÂâ≤Âô® -->
        <div class="resizer"></div>


        <!-- Âè≥‰æßÁöÑ Original Article Ê®°Âùó -->
        <div class="module" id="original-article">
            <h2>Original Article</h2>
            <div v-if="selectedArticle">
                <!-- ÊñáÁ´†Ê†áÈ¢ò -->
                <h3 class="article-title">{{ selectedArticle.title }}</h3>

                <!-- ÊñáÁ´†ÈìæÊé• -->
                <div class="article-link" style="margin-bottom: 5px;">
                    üåê {{ selectedArticle.domain }}<a style="margin-left: 5px;" :href="selectedArticle.url"
                        target="_blank">Read
                        full article</a>
                </div>


                <!-- ÊÆµËêΩÂÜÖÂÆπ -->
                <div v-for="(paragraph, index) in selectedArticle.paragraphs" :key="index"
                    :id="'paragraph-' + selectedArticle.id + '-' + index" class="paragraph"
                    :class="{ 'active': selectedParagraphId === `${selectedArticle.id}_p${index + 1}` }"
                    :style="{ borderLeft: `7px solid ${getParagraphColor(paragraph.content)}` }"
                    @click="selectParagraph(selectedArticle.id, index)"
                    @mouseover="highlightConnection(selectedArticle.id, index + 1)" @mouseout="removeHighlight()"
                    @mouseup="handleTextSelection(selectedArticle.id, index)">
                    <div class="paragraph-content">
                        <h4 v-if="paragraph.subtitle">{{ paragraph.subtitle }}</h4>
                        <p v-html="formatParagraphContent(paragraph.content)"></p>
                    </div>

                    <!-- È´ò‰∫ÆÂõæÊ†á -->
                    <div v-if="highlightButtonVisible" class="highlight-icon"
                        :style="{ top: `${highlightButtonPosition.y}px`, left: `${highlightButtonPosition.x}px` }"
                        @click="applyHighlight(selectedArticle.id, index)">
                        <span>+</span>
                    </div>

                </div>

            </div>
            <div v-else>
                <p>Please select an article to view its content.</p>
            </div>
        </div>

    </div>

</template>


<script type="module">
import draggable from "vuedraggable";
import * as d3 from 'd3';

export default {
    data() {
        return {
            articles: [],
            filterStatus: 'all', // ÈªòËÆ§ÊòæÁ§∫ÊâÄÊúâÊñáÁ´†
            angles: [],
            clusteredParagraphs: {},
            selectedArticle: null,
            selectedArticleId: null, // ÂΩìÂâçÈÄâ‰∏≠ÊñáÁ´†ÁöÑ ID
            sortOrder: 'publishedAt', // ÈªòËÆ§ÊéíÂ∫èÊñπÂºè
            weights: {
                recommendation: 0.5, // Êé®ËçêÂàÜÊï∞ÁöÑÊùÉÈáçÔºàÊªëÂä®Êù°ÊéßÂà∂Ôºâ
            },
            similarities: {}, // ÊÆµËêΩÁõ∏‰ººÂ∫¶Êï∞ÊçÆ
            similaritiesSentences: {}, // ÊÆµËêΩÂè•Â≠êÁõ∏‰ººÂ∫¶Êï∞ÊçÆ
            selectedParagraphId: null, // ÂΩìÂâçÈÄâ‰∏≠ÊÆµËêΩÁöÑ ID
            selectedParagraphAngle: null, // ÂΩìÂâçÈÄâ‰∏≠ÊÆµËêΩÂØπÂ∫îÁöÑËßíÂ∫¶
            selectedParagraphSimilarities: [], // ÂΩìÂâçÊÆµËêΩÁöÑÁõ∏‰ººÊÆµËêΩÂàóË°®
            selectedSimilarParagraph: null, // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÁõ∏‰ººÊÆµËêΩ
            defaultWeight: { max: 1.0, min: 0.1 }, // Áî®‰∫éÊùÉÈáçËÆ°ÁÆó
            activeTab: 'analysisAngles', // ÈªòËÆ§ÊòæÁ§∫ Analysis Angles ÈÄâÈ°πÂç°
            hideUnmatchedBars: false, // ÊéßÂà∂ÊòØÂê¶ÈöêËóèÊú™ÂåπÈÖçÁöÑÊÆµËêΩ
            connectionsVisible: true, // ÂàùÂßãÁä∂ÊÄÅ‰∏∫ÊòæÁ§∫ËøûÊé•Á∫ø
            allSummariesExpanded: false, // ÊâÄÊúâÊëòË¶ÅÁöÑÂ±ïÂºÄÁä∂ÊÄÅ
            allBarsExpanded: false,      // ÊâÄÊúâ Bars ÁöÑÂ±ïÂºÄÁä∂ÊÄÅ
            highlights: {}, // Â≠òÂÇ®È´ò‰∫ÆÂíåÊ≥®Èáä‰ø°ÊÅØ
            selectionRange: null, // Â≠òÂÇ®Áî®Êà∑ÈÄâ‰∏≠ÁöÑ Range ÂØπË±°
            highlightButtonPosition: { x: 0, y: 0 }, // È´ò‰∫ÆÂõæÊ†áÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ
            highlightButtonVisible: false, // ÊéßÂà∂È´ò‰∫ÆÂõæÊ†áÊòØÂê¶ÊòæÁ§∫
            highlightedElements: [],// Áî®‰∫éÂ≠òÂÇ®ÂΩìÂâçÊâÄÊúâÈ´ò‰∫ÆÁöÑÂè•Â≠êÂÖÉÁ¥†
            isDragging: false, // ÊòØÂê¶Ê≠£Âú®ÊãñÊãΩ
        };
    },
    components: {
        draggable,
    },
    computed: {

        sortedAngles() {
            return [...this.angles].sort((a, b) => b.paragraphCount - a.paragraphCount);
        },
        filteredAndSortedArticles() {
            // Ëé∑ÂèñÁî®Êà∑ÈÄâ‰∏≠ÁöÑËßíÂ∫¶
            const selectedAngles = this.angles.filter(angle => angle.selected).map(angle => angle.subtheme_id);

            // Á≠õÈÄâÊñáÁ´†ÔºåÂè™‰øùÁïôÂåÖÂê´ÈÄâ‰∏≠ËßíÂ∫¶ÁöÑÊñáÁ´†
            let filtered = this.articles.filter(article => {
                return article.paragraphColors.some(color =>
                    this.angles.some(angle => angle.selected && angle.color === color)
                );
            });

            if (this.filterStatus === 'unread') {
                filtered = filtered.filter(article => !article.isRead); // Êú™ÈòÖËØª
            } else if (this.filterStatus === 'read') {
                filtered = filtered.filter(article => article.isRead); // Â∑≤ÈòÖËØª
            }


            // ÊåâÊéíÂ∫èÊñπÂºèÊéíÂ∫èÊñáÁ´†
            if (this.sortOrder === 'repetitionRate') {
                filtered.sort((a, b) => {
                    if (a.repetitionRate === null) return 1; // Ê≤°ÊúâÈáçÂ§çÁéáÁöÑÊéíÂú®ÂêéÈù¢
                    if (b.repetitionRate === null) return -1;
                    return a.repetitionRate - b.repetitionRate; // ‰ΩéÈáçÂ§çÁéá‰ºòÂÖà
                });
            } else if (this.sortOrder === 'comprehensiveScore') {
                filtered.sort((a, b) => b.comprehensiveScore - a.comprehensiveScore); // ÁªºÂêàÂæóÂàÜË∂äÈ´òË∂äÂ•Ω
            } else if (this.sortOrder === 'angleCategoryCount') {
                filtered.sort((a, b) => {
                    const aCategories = new Set(
                        a.paragraphColors
                            .map(color => this.angles.find(angle => angle.color === color))
                            .filter(angle => angle && selectedAngles.includes(angle.subtheme_id))
                    ).size;
                    const bCategories = new Set(
                        b.paragraphColors
                            .map(color => this.angles.find(angle => angle.color === color))
                            .filter(angle => angle && selectedAngles.includes(angle.subtheme_id))
                    ).size;
                    return bCategories - aCategories;
                });
            } else if (this.sortOrder === 'recommendationScore') {
                filtered.sort((a, b) => b.recommendationScore - a.recommendationScore); // ÊåâÊé®ËçêÂàÜÊï∞ÈôçÂ∫èÊéíÂ∫è
            } else if (this.sortOrder === 'publishedAt') {
                filtered.sort((a, b) => new Date(a.publishedAt) - new Date(b.publishedAt)); // ÊåâÂèëÂ∏ÉÊó∂Èó¥ÂçáÂ∫èÊéíÂ∫è
            }

            return filtered;
        },
    },
    methods: {
        async loadData() {
            // Load JSON data
            const articlesData = await fetch('news_data_with_paragraphs.json').then(res => res.json());
            const anglesData = await fetch('merged_news_subthemes.json').then(res => res.json());
            const clusteredData = await fetch('clustered_paragraphs_hdbscan2.json').then(res => res.json());
            const similaritiesData = await fetch('paragraph_pairwise_similarities.json').then(res => res.json());
            const similaritieSentencesData = await fetch('paragraph_sentence_similarities.json').then(res => res.json());

            // ‰∏∫ÊØèÁØáÊñáÁ´†ÁöÑÊÆµËêΩËÆ°ÁÆóÂ≠óÊï∞
            articlesData.forEach(article => {
                article.paragraphs.forEach(paragraph => {
                    paragraph.wordCount = this.calculateWordCount(paragraph.content);
                });
            });


            // ÊåâÊéíÂ∫èÂä®ÊÄÅÂàÜÈÖçÊùÉÈáç
            const maxWeight = 1.0; // ÊúÄÈ´òÊùÉÈáç
            const minWeight = 0.1; // ÊúÄ‰ΩéÊùÉÈáç
            const step = (maxWeight - minWeight) / (anglesData.length - 1);

            // Assign unique colors to angles and count paragraphs
            const colors = [
                "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd",
                "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf",
                "#393b79", "#5254a3", "#6b6ecf", "#9c9ede", "#637939",
                "#8ca252", "#b5cf6b", "#cedb9c", "#8c6d31", "#bd9e39"
            ];

            anglesData.forEach((angle, index) => {
                angle.color = colors[index % colors.length];

                // ÊéíÂ∫èËßíÂ∫¶Êï∞ÊçÆ
                angle.paragraphCount = clusteredData[angle.subtheme_id]?.length || 0;
                angle.selected = true; // ÈªòËÆ§ÊâÄÊúâËßíÂ∫¶ÈÉΩË¢´ÈÄâ‰∏≠

                angle.weight = maxWeight - index * step; // Âä®ÊÄÅÂàÜÈÖçÊùÉÈáç

                angle.expandedSummary = false; // ÊëòË¶ÅÊäòÂè†Áä∂ÊÄÅ
                angle.expandedBars = false; // Êü±Áä∂ÂõæÊäòÂè†Áä∂ÊÄÅ

                const paragraphs = clusteredData[angle.subtheme_id] || [];
                angle.paragraphs = paragraphs.map(paragraph => {

                    // Ëß£Êûê unique_idÔºåÊèêÂèñ article_id ÂíåÊÆµËêΩÁ¥¢Âºï
                    const [articleId, paragraphIndexStr] = paragraph.unique_id.split('_p');
                    const paragraphIndex = parseInt(paragraphIndexStr, 10) - 1; // ËΩ¨‰∏∫‰ªé 0 ÂºÄÂßãÁöÑÁ¥¢Âºï

                    // ÊâæÂà∞ÂåπÈÖçÁöÑÊñáÁ´†ÂíåÊÆµËêΩ
                    const matchingArticle = articlesData.find(article => article.id === articleId);
                    const matchingParagraph = matchingArticle?.paragraphs[paragraphIndex] || {};
                    return {
                        unique_id: paragraph.unique_id,
                        wordCount: matchingParagraph.wordCount || 0,
                        article_id: articleId,
                        paragraph_index: paragraphIndexStr,
                        content: matchingParagraph.content || '',
                    };
                });
                // ÊåâÂ≠óÊï∞‰ªéÈ´òÂà∞‰ΩéÊéíÂ∫èÊÆµËêΩ
                angle.paragraphs.sort((a, b) => b.wordCount - a.wordCount);

            });

            // ÈªòËÆ§ÊåâÊÆµËêΩÊï∞ÈáèÊéíÂ∫èÔºàÈôçÂ∫èÔºâ
            anglesData.sort((a, b) => b.paragraphCount - a.paragraphCount);

            // Â∞ÜËßíÂ∫¶È¢úËâ≤Êò†Â∞ÑÂà∞ÊñáÁ´†ÊÆµËêΩ
            articlesData.forEach(article => {
                article.paragraphColors = article.paragraphs.map(paragraph => {
                    for (const [angleId, paragraphs] of Object.entries(clusteredData)) {
                        if (paragraphs.some(p => p.article_id === article.id && p.content === paragraph.content)) {
                            return anglesData.find(angle => angle.subtheme_id === angleId).color;
                        }
                    }
                    return '#ccc'; // Default color if no match
                });
                // console.log(`Article: ${article.title}`, article.paragraphColors);
                article.recommendationScore = this.calculateRecommendationScore(article);
            });

            // console.log('Angles Data Loaded:', anglesData);


            this.articles = articlesData;
            this.angles = anglesData;
            this.clusteredParagraphs = clusteredData;
            this.similarities = similaritiesData; // ‰øùÂ≠òÊÆµËêΩÁõ∏‰ººÂ∫¶Êï∞ÊçÆ
            this.similaritiesSentences = similaritieSentencesData;

            articlesData.forEach(article => {
                article.recommendationScore = this.calculateRecommendationScore(article);
            });

        },
        setActiveTab(tab) {
            this.activeTab = tab; // Êõ¥Êñ∞ÂΩìÂâçÊ®°ÂùóÁä∂ÊÄÅ
            if (this.connectionsVisible) {
                this.drawConnections(); // ÂàáÊç¢Ê®°ÂùóÊó∂ÈáçÊñ∞ÁªòÂà∂ËøûÁ∫ø
            }
        },
        // Ê∑ªÂä†ËÆ°ÁÆóÂ≠óÊï∞ÁöÑËæÖÂä©ÊñπÊ≥ï
        calculateWordCount(content) {
            if (!content) return 0;
            // ÊåâÁ©∫Ê†ºÊãÜÂàÜÂçïËØçÂπ∂ËÆ°ÁÆóÈïøÂ∫¶ÔºàÈÄÇÁî®‰∫éËã±ÊñáÊñáÊú¨Ôºâ
            return content.split(/\s+/).filter(word => word).length;
        },
        calculateBarWidth(wordCount) {
            const minWidth = 20; // ÊúÄÂ∞èÂÆΩÂ∫¶
            const maxWidth = 300; // ÊúÄÂ§ßÂÆΩÂ∫¶


            const maxWordCount = Math.max(
                ...this.articles.flatMap(article => article.paragraphs.map(p => p.wordCount))
            ); // Ëé∑ÂèñÊâÄÊúâÊÆµËêΩÁöÑÊúÄÂ§ßÂ≠óÊï∞

            // Ê†πÊçÆÂ≠óÊï∞Êò†Â∞ÑÂÆΩÂ∫¶
            return Math.max(minWidth, (wordCount / maxWordCount) * maxWidth);
        },
        showArticle(article, articleId) {
            // Ê∏ÖÈô§Áé∞ÊúâÈ´ò‰∫Æ
            this.clearHighlights();

            this.logDebug('Showing article: ' + article.id);
            this.selectedArticle = article;
            this.selectedArticleId = articleId;

            this.$nextTick(() => {
                if (this.connectionsVisible) {
                    this.drawConnections();
                }

                if (this.highlights[article.id]) {
                    this.highlights[article.id].forEach(highlightData => {
                        this.renderHighlight(article.id, highlightData);
                    });
                }
            });
        },
        // Ê†ºÂºèÂåñÊÆµËêΩÂÜÖÂÆπÔºåÊõøÊç¢ \n ‰∏∫ <br />
        formatParagraphContent(content) {
            if (!content) return '';

            // ÂàÜÂè•ÈÄªËæëÔºöÊåâÂè•Âè∑ (.)„ÄÅÈóÆÂè∑ (?) ÂíåÊÑüÂèπÂè∑ (!) ÂàÜÈöîÂè•Â≠ê
            const splitIntoSentences = (text) => {
                const sentenceRegex = /([^.!?]+[.!?]+)/g; // ÂåπÈÖçÂè•Â≠êÔºà‰ª•Ê†áÁÇπÁ¨¶Âè∑ÁªìÊùüÔºâ
                const sentences = text.match(sentenceRegex) || []; // ÊèêÂèñÂåπÈÖçÁöÑÂè•Â≠ê
                return sentences.map(sentence => sentence.trim()); // ÂéªÊéâÈ¶ñÂ∞æÁ©∫Ê†º
            };

            // ÊõøÊç¢Êç¢Ë°åÁ¨¶‰∏∫ <br />ÔºåÂπ∂ËøõË°åÂàÜÂè•
            const sentences = splitIntoSentences(content.replace(/\n/g, '<br />'));

            // Â∞ÜÊØè‰∏™Âè•Â≠êÂåÖË£πÂú® <span> ‰∏≠ÔºåÂπ∂‰∏∫Êç¢Ë°åÁ¨¶‰øùÁïô <br />
            return sentences
                .map((sentence, index) =>
                    `<span class="sentence" data-sentence-index="${index}">${sentence}</span>`
                )
                .join(' '); // Áî®Á©∫Ê†ºÊãºÊé•Âè•Â≠ê
        },

        getParagraphColor(content) {
            for (const [angleId, paragraphs] of Object.entries(this.clusteredParagraphs)) {
                if (paragraphs.some(p => p.content === content)) {
                    return this.angles.find(angle => angle.subtheme_id === angleId).color;
                }
            }
            return '#ccc'; // Default color if no match
        },

        toggleAngleSelection(angle) {
            angle.selected = !angle.selected; // ÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ
        },
        scrollToParagraph(articleId, index) {
            this.logDebug('Scrolling to paragraph: Article ID: ' + articleId + ', Paragraph Index: ' + index);
            // Automatically set the selected article if not already set
            const article = this.articles.find(a => a.id === articleId);
            if (this.selectedArticle !== article) {
                this.selectedArticle = article;
            }

            // Scroll to the specific paragraph
            this.$nextTick(() => {
                const paragraphElement = document.getElementById(`paragraph-${articleId}-${index}`);
                if (paragraphElement) {
                    paragraphElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        },
        // chongfulv
        selectParagraph(articleId, paragraphIndex) {
            // Ê∏ÖÈô§Áé∞ÊúâÈ´ò‰∫Æ
            this.clearHighlights();
            this.selectedSimilarParagraph = null;

            // Ëé∑ÂèñÁÇπÂáªÊÆµËêΩÁöÑ unique_id
            const paragraphKey = `${articleId}_p${paragraphIndex + 1}`;
            this.selectedParagraphId = paragraphKey;

            // ÈÅçÂéÜ clustered_paragraphs_hdbscan2.jsonÔºåÊâæÂà∞ËØ•ÊÆµËêΩÊâÄÂú®ÁöÑËßíÂ∫¶ÁªÑ
            const angleId = Object.keys(this.clusteredParagraphs).find(key =>
                this.clusteredParagraphs[key].some(paragraph => paragraph.unique_id === paragraphKey)
            );

            if (!angleId) {
                console.warn('Angle not found for paragraph:', paragraphKey);
                this.selectedParagraphSimilarities = [];
                return;
            }

            // Êõ¥Êñ∞ÂΩìÂâçÈÄâ‰∏≠ÊÆµËêΩÁöÑËßíÂ∫¶
            this.selectedParagraphAngle = this.angles.find(angle => angle.subtheme_id === angleId);


            // ÈÅçÂéÜ paragraph_pairwise_similarities.jsonÔºåÊü•Êâæ‰∏éËØ•ÊÆµËêΩÁöÑÁõ∏‰ººÊÆµËêΩ
            const similarityData = [];
            this.clusteredParagraphs[angleId].forEach(paragraph => {
                const paragraphUniqueId = paragraph.unique_id;

                // ÊèêÂèñ articleId Âíå paragraphIndex
                const [extractedArticleId, paragraphId] = paragraphUniqueId.split('_p');
                const extractedParagraphIndex = parseInt(paragraphId) - 1; // ËΩ¨Êç¢‰∏∫‰ªé 0 ÂºÄÂßãÁöÑÁ¥¢Âºï

                // Êü•Êâæ paragraph_pairwise_similarities.json ‰∏≠ÁöÑÁõ∏‰ººÂ∫¶
                const matches = (this.similarities[angleId] || []).filter(similarity =>
                    (similarity.paragraph_1_id === paragraphKey && similarity.paragraph_2_id === paragraphUniqueId) ||
                    (similarity.paragraph_2_id === paragraphKey && similarity.paragraph_1_id === paragraphUniqueId)
                );

                matches.forEach(match => {
                    similarityData.push({
                        paragraph: paragraph.content, // ÊÆµËêΩÂÜÖÂÆπ
                        similarity: match.similarity, // Áõ∏‰ººÂ∫¶
                        articleId: extractedArticleId, // ‰ªé unique_id ÊèêÂèñÁöÑ articleId
                        paragraphIndex: extractedParagraphIndex, // ‰ªé unique_id ÊèêÂèñÁöÑÊÆµËêΩÁ¥¢Âºï
                        wordCount: this.calculateWordCount(paragraph.content), // Â∞ÜÂ≠óÊï∞Âä†ÂÖ•Âà∞Áõ∏‰ººÊÄßÊï∞ÊçÆ
                        originalparagraphKey: paragraphKey
                    });
                });
            });

            // ÊåâÁõ∏‰ººÂ∫¶ÈôçÂ∫èÊéíÂ∫è
            this.selectedParagraphSimilarities = similarityData.sort((a, b) => b.similarity - a.similarity);

        },
        highlightSentencePairs(selectedParagraphId, originalparagraphKey) {
            // ÂÖàÊ∏ÖÈô§ÊâÄÊúâÊóßÈ´ò‰∫Æ
            this.clearHighlights();

            const matchingPairs = [];
            Object.values(this.similaritiesSentences).forEach(angle => {
                angle.forEach(pair => {
                    if ((pair.paragraph_1.unique_id === selectedParagraphId && pair.paragraph_2.unique_id === originalparagraphKey) || (pair.paragraph_2.unique_id === selectedParagraphId && pair.paragraph_1.unique_id === originalparagraphKey)) {
                        pair.sentence_similarities.forEach(sentencePair => {
                            if (sentencePair.similarity > 0.70) {
                                matchingPairs.push({
                                    ...sentencePair,
                                    paragraph_1: pair.paragraph_1,
                                    paragraph_2: pair.paragraph_2
                                });
                            }
                        });
                    }
                });
            });
            this.$nextTick(() => {
                // ÂØπÂè•Â≠êÊ∑ªÂä†È´ò‰∫ÆÂíå hover ËÅîÂä®ÈÄªËæë
                matchingPairs.forEach(pair => {
                    const sentence1Element = document.querySelector(`#paragraph-${pair.paragraph_1.article_id}-${pair.paragraph_1.unique_id.split('_p')[1] - 1} [data-sentence-index="${pair.sentence_1_index}"]`);
                    const sentence2Element = document.querySelector(`#paragraph-${pair.paragraph_2.article_id}-${pair.paragraph_2.unique_id.split('_p')[1] - 1} [data-sentence-index="${pair.sentence_2_index}"]`);
                    // console.log(sentence1Element, sentence2Element);

                    if (sentence1Element && sentence2Element) {
                        sentence1Element.classList.add('highlight-sentence');
                        sentence2Element.classList.add('highlight-sentence');
                        this.highlightedElements.push(sentence1Element); // Â≠òÂÇ®È´ò‰∫ÆÂè•Â≠êÂÖÉÁ¥†
                        this.highlightedElements.push(sentence2Element); // Â≠òÂÇ®È´ò‰∫ÆÂè•Â≠êÂÖÉÁ¥†

                        sentence1Element.addEventListener('mouseover', () => {
                            sentence2Element.classList.add('highlight-hover');
                        });
                        sentence1Element.addEventListener('mouseout', () => {
                            sentence2Element.classList.remove('highlight-hover');
                        });
                        sentence2Element.addEventListener('mouseover', () => {
                            sentence1Element.classList.add('highlight-hover');
                        });
                        sentence2Element.addEventListener('mouseout', () => {
                            sentence1Element.classList.remove('highlight-hover');
                        });
                    }
                });

            });

        },
        // Â∫îÁî®‰∫éÊÆµËêΩÂØπÊØîÁöÑÂè•Â≠êÈ´ò‰∫Æ
        clearHighlights() {
            // ÈÅçÂéÜÂπ∂ÁßªÈô§ÊâÄÊúâÈ´ò‰∫ÆÊ†∑Âºè
            this.highlightedElements.forEach(element => {
                if (element) {
                    element.classList.remove('highlight-sentence'); // ÁßªÈô§È´ò‰∫ÆÁ±ª
                    element.style.backgroundColor = ''; // ÁßªÈô§ËÉåÊôØÈ¢úËâ≤
                }
            });
            // Ê∏ÖÁ©∫Â≠òÂÇ®ÁöÑÈ´ò‰∫ÆÂÖÉÁ¥†Êï∞ÁªÑ
            this.highlightedElements = [];
        },
        // Ê†πÊçÆÊÆµËêΩÂÜÖÂÆπËé∑ÂèñÂØπÂ∫îÁöÑÈ¢úËâ≤
        getBarColor(paragraphContent) {
            for (const [angleId, paragraphs] of Object.entries(this.clusteredParagraphs)) {
                if (paragraphs.some(p => p.content === paragraphContent)) {
                    const angle = this.angles.find(angle => angle.subtheme_id === angleId);
                    return angle ? angle.color : '#ccc'; // ÈªòËÆ§ÁÅ∞Ëâ≤
                }
            }
            return '#ccc';
        },

        // Ëé∑ÂèñÊü±Áä∂ÂõæÈÄèÊòéÂ∫¶ÔºåÈáçÊñ∞Êò†Â∞ÑÁõ∏‰ººÂ∫¶ËåÉÂõ¥
        getBarOpacity(similarity) {
            const minSim = 0.75; // Áõ∏‰ººÂ∫¶ÁöÑÊúÄ‰ΩéÂÄº
            const maxSim = 0.97; // Áõ∏‰ººÂ∫¶ÁöÑÊúÄÈ´òÂÄº
            const minOpacity = 0.1; // ÊúÄ‰ΩéÈÄèÊòéÂ∫¶
            const maxOpacity = 1.0; // ÊúÄÈ´òÈÄèÊòéÂ∫¶

            if (similarity <= minSim) {
                return minOpacity; // Â¶ÇÊûúÁõ∏‰ººÂ∫¶‰Ωé‰∫éÊúÄÂ∞èÂÄºÔºåÁõ¥Êé•ËøîÂõûÊúÄ‰ΩéÈÄèÊòéÂ∫¶
            }

            // Á∫øÊÄßÊèíÂÄºÔºåÂ∞ÜÁõ∏‰ººÂ∫¶Êò†Â∞ÑÂà∞ÈÄèÊòéÂ∫¶ËåÉÂõ¥
            return ((similarity - minSim) / (maxSim - minSim)) * (maxOpacity - minOpacity) + minOpacity;
        },

        // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊÆµËêΩÂÜÖÂÆπ
        showSimilarParagraph(paragraph, articleId, paragraphIndex, originalparagraphKey) {
            // Ê∏ÖÈô§Áé∞ÊúâÈ´ò‰∫Æ
            this.clearHighlights();

            this.selectedSimilarParagraph = {
                content: paragraph, // ÊÆµËêΩÂÜÖÂÆπ
                paragraphIndex: paragraphIndex, // ÊÆµËêΩÁ¥¢Âºï
                articleId: articleId
            };
            // Á≠õÈÄâÂπ∂È´ò‰∫ÆÁõ∏‰ººÂè•Â≠êÂØπ
            const paragraphKey = `${articleId}_p${paragraphIndex + 1}`;
            this.highlightSentencePairs(paragraphKey, originalparagraphKey);
        },

        // ËÆ°ÁÆóÊé®ËçêÂàÜÊï∞
        calculateRecommendationScore(article) {
            // ÊâæÂà∞ÊñáÁ´†ÁöÑÊâÄÊúâËßíÂ∫¶
            const articleAngles = new Set(
                article.paragraphColors
                    .map(color => this.angles.find(angle => angle.color === color))
                    .filter(angle => angle) // ËøáÊª§ÊéâÊú™ÊâæÂà∞ÁöÑËßíÂ∫¶
            );

            if (articleAngles.size === 0) return 0;

            let totalWeightedScore = 0; // ÂàÜÂ≠êÔºöÊùÉÈáç‰∏éÂ≠óÊï∞ÁöÑÂä†ÊùÉÂíå
            let totalWordCount = 0;    // ÂàÜÊØçÔºöÊâÄÊúâÂÖ≥ËÅîËßíÂ∫¶ÁöÑÂ≠óÊï∞ÊÄªÂíå


            articleAngles.forEach(angle => {
                // ÈÅçÂéÜÊÆµËêΩÔºåÊ†πÊçÆÊÆµËêΩÈ¢úËâ≤ÂåπÈÖçËßíÂ∫¶
                let angleWordCount = 0;
                article.paragraphs.forEach((paragraph, index) => {
                    if (article.paragraphColors[index] === angle.color) {
                        angleWordCount += paragraph.wordCount || 0; // Á¥ØÂä†Â±û‰∫éËØ•ËßíÂ∫¶ÁöÑÊÆµËêΩÂ≠óÊï∞
                    }
                });
                // Âä†ÊùÉÂàÜÊï∞Á¥ØÂä†
                totalWeightedScore += (angle.weight || 0) * angleWordCount;
                // ÊÄªÂ≠óÊï∞Á¥ØÂä†
                totalWordCount += angleWordCount;

            });

            if (totalWordCount === 0) return 0;
            return totalWeightedScore / totalWordCount;

        },
        toggleSummary(angle) {
            angle.expandedSummary = !angle.expandedSummary; // ÊëòË¶ÅÊäòÂè†
        },
        toggleBars(angle) {
            angle.expandedBars = !angle.expandedBars; // Êü±Áä∂ÂõæÊäòÂè†
        },
        toggleAllSummaries() {
            this.allSummariesExpanded = !this.allSummariesExpanded;

            // ÈÅçÂéÜ anglesÔºåÊõ¥Êñ∞ÊØè‰∏™ element ÁöÑ expandedSummary Áä∂ÊÄÅ
            this.angles.forEach((angle) => {
                angle.expandedSummary = this.allSummariesExpanded;
            });
        },
        toggleAllBars() {
            this.allBarsExpanded = !this.allBarsExpanded;

            // ÈÅçÂéÜ anglesÔºåÊõ¥Êñ∞ÊØè‰∏™ element ÁöÑ expandedBars Áä∂ÊÄÅ
            this.angles.forEach((angle) => {
                angle.expandedBars = this.allBarsExpanded;
            });
        },
        // ÊãñÂä®ÊïàÊûú
        onAngleSortEnd() {
            // Ê†πÊçÆÂΩìÂâçÊéíÂ∫èÈáçÊñ∞ÂàÜÈÖçÊùÉÈáç
            const maxWeight = this.defaultWeight.max;
            const minWeight = this.defaultWeight.min;
            const step = (maxWeight - minWeight) / (this.angles.length - 1);

            this.angles.forEach((angle, index) => {
                angle.weight = maxWeight - index * step; // ÈáçÊñ∞ËÆ°ÁÆóÊùÉÈáç
            });

            // ÈáçÊñ∞ËÆ°ÁÆóÊé®ËçêÂàÜÊï∞
            this.articles.forEach(article => {
                article.recommendationScore = this.calculateRecommendationScore(article);
                // Êõ¥Êñ∞ÁªºÂêàÂæóÂàÜ
                this.updateComprehensiveScores(article);
            });

            // Â¶ÇÊûúÂΩìÂâçÊéíÂ∫èÊòØÊåâÊé®ËçêÂàÜÊï∞ÊéíÂ∫èÔºåÊõ¥Êñ∞ÊñáÁ´†ÂàóË°®
            if (this.sortOrder === 'recommendationScore') {
                this.articles.sort((a, b) => b.recommendationScore - a.recommendationScore);
            }
        },
        // ÁªòÂà∂Êõ≤Á∫ø
        drawConnections() {
            this.$nextTick(() => {
                // Ê∏ÖÁ©∫ÊóßÁöÑËøûÊé•Á∫ø
                d3.select('#connection-lines').selectAll('*').remove();

                if (this.activeTab === 'analysisAngles') {
                    // ËßíÂ∫¶ÂàÜÊûêÊ®°ÂùóËøûÁ∫øÈÄªËæë
                    const anglesElement = document.getElementById('analysis-angles');
                    const articlesElement = document.getElementById('article-list');
                    const tabElement = document.getElementById("analysis-paragraph-tabs");
                    const originalarticlesElement = document.getElementById('original-article');

                    if (!anglesElement || !articlesElement) return;

                    const connections = [];
                    const secondaryConnections = []; // Êñ∞Â¢ûÔºöÊü±Áä∂Âùó‰∏éÂéüÂßãÊñáÁ´†ÊÆµËêΩÁöÑËøûÊé•


                    document.querySelectorAll('.word-count-bar-chart .bar-container').forEach(bar => {
                        const articleId = bar.getAttribute('data-article-id');
                        const paragraphIndex = bar.getAttribute('data-paragraph-index');
                        const articleElement = document.getElementById(`article-${articleId}`);
                        const paragraphElement = document.getElementById(`paragraph-${articleId}-${paragraphIndex - 1}`);

                        if (articleElement) {
                            const barRect = bar.getElementsByClassName('bar')[0].getBoundingClientRect();
                            const articleRect = articleElement.getBoundingClientRect();

                            if (
                                this.isElementInModuleViewport(barRect, tabElement) &&
                                this.isElementInModuleViewport(articleRect, articlesElement)
                            ) {
                                connections.push({
                                    // ÊâãÂä®Êîπ‰∫Ü
                                    x1: barRect.left,
                                    y1: barRect.top + barRect.height / 2,
                                    x2: articleRect.right,
                                    y2: articleRect.top + articleRect.height / 2,
                                    articleId,
                                    paragraphIndex,
                                });
                            }
                        }


                        if (this.selectedArticle && paragraphElement) {
                            // Á¨¨‰∫åÁ±ªËøûÊé•ÔºöÊü±Áä∂ÂùóÂà∞ÂéüÂßãÊñáÁ´†ÊÆµËêΩ
                            const barRect = bar.getElementsByClassName('bar')[0].getBoundingClientRect();
                            const paragraphElementRect = paragraphElement.getBoundingClientRect();
                            if (
                                this.isElementInModuleViewport(barRect, tabElement) &&
                                this.isElementInModuleViewport(paragraphElementRect, originalarticlesElement)
                            ) {
                                secondaryConnections.push({
                                    x1: barRect.right + 90, // Êü±Áä∂ÂùóÂè≥Á´Ø,ÁïôÂá∫Ê†áÊ≥®‰ΩçÁΩÆ
                                    y1: barRect.top + barRect.height / 2,
                                    x2: paragraphElementRect.left, // ÂéüÂßãÊñáÁ´†ÊÆµËêΩÂ∑¶Á´Ø
                                    y2: paragraphElementRect.top + paragraphElementRect.height / 2,
                                    articleId,
                                    paragraphIndex,
                                });
                            }
                        }



                    });

                    const svg = d3.select('#connection-lines');
                    connections.forEach(connection => {
                        svg
                            .append('path')
                            .attr('d', this.generatePath(connection))
                            .attr('stroke', '#ccc')
                            .attr('stroke-width', 2)
                            .attr('fill', 'none')
                            .attr('data-article-id', connection.articleId)
                            .attr('data-paragraph-index', connection.paragraphIndex)
                            .classed('connection-line', true);
                    });
                    // ÁªòÂà∂Ê¨°ËøûÊé•ÔºöÊü±Áä∂ÂùóÂà∞ÂéüÂßãÊñáÁ´†ÊÆµËêΩ
                    secondaryConnections.forEach(connection => {
                        svg
                            .append('path')
                            .attr('d', this.generatePath(connection))
                            .attr('stroke', '#888') // ‰ΩøÁî®‰∏çÂêåÈ¢úËâ≤Âå∫ÂàÜÊ¨°ËøûÊé•
                            .attr('stroke-width', 1.5) // Ê¨°ËøûÊé•Á∫øÊù°Áï•ÁªÜ
                            .attr('fill', 'none')
                            .attr('data-article-id', connection.articleId)
                            .attr('data-paragraph-index', connection.paragraphIndex)
                            .classed('connection-line', true); // Ê¨°ËøûÊé•Ê†∑Âºè
                    });


                } else if (this.activeTab === 'paragraphComparison') {
                    // ÊÆµËêΩÂØπÊØîÊ®°ÂùóËøûÁ∫øÈÄªËæë
                    const articlesElement = document.getElementById("article-list");
                    const comparisonElement = document.getElementById("paragraph-comparison");
                    const originalarticlesElement = document.getElementById('original-article');

                    if (!articlesElement || !comparisonElement) return;


                    // ÈÅçÂéÜÊâÄÊúâÊü±Áä∂ÂùóÂíåÊñáÁ´†ÔºåÊâæÂà∞ÂÆÉ‰ª¨ÁöÑÂùêÊ†á
                    const connections = [];
                    const secondaryConnections = []; // Êñ∞Â¢ûÔºöÊü±Áä∂Âùó‰∏éÂéüÂßãÊñáÁ´†ÊÆµËêΩÁöÑËøûÊé•

                    document.querySelectorAll('.bar-container').forEach(bar => {
                        const articleId = bar.getAttribute('data-article-id');
                        const paragraphIndex = bar.getAttribute('data-paragraph-index');
                        const tabElement = document.getElementById("analysis-paragraph-tabs");
                        const articleElement = document.getElementById(`article-${articleId}`);
                        const paragraphElement = document.getElementById(`paragraph-${articleId}-${paragraphIndex}`);

                        if (articleElement) {
                            // Ëé∑ÂèñÂÖÉÁ¥†ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ
                            const barRect = bar.getBoundingClientRect();
                            const articleRect = articleElement.getBoundingClientRect();

                            // Âà§Êñ≠ÊòØÂê¶Âú®Ê®°ÂùóÁöÑÂèØËßÜÂå∫ÂüüÂÜÖ
                            const isBarVisible = this.isElementInModuleViewport(barRect, comparisonElement);
                            const isArticleVisible = this.isElementInModuleViewport(articleRect, articlesElement);

                            // Â¶ÇÊûú‰∫åËÄÖÈÉΩÂú®Â±èÂπïÂÜÖÔºåÊâçÊ∑ªÂä†Âà∞ËøûÊé•ÂàóË°®
                            if (isBarVisible && isArticleVisible) {
                                connections.push({
                                    x1: articleRect.right, // ÊñáÁ´†Âè≥ËæπÁöÑÂùêÊ†á
                                    y1: articleRect.top + articleRect.height / 2, // ÊñáÁ´†ÂûÇÁõ¥Â±Ö‰∏≠ÁöÑÂùêÊ†á
                                    x2: barRect.left, // ÊÆµËêΩÊü±Áä∂ÂùóÂ∑¶ËæπÁöÑÂùêÊ†á
                                    y2: barRect.top + barRect.height / 2, // ÊÆµËêΩÊü±Áä∂ÂùóÂûÇÁõ¥Â±Ö‰∏≠ÁöÑÂùêÊ†á
                                    articleId,
                                    paragraphIndex
                                });
                            }
                        }

                        if (this.selectedArticle && paragraphElement) {
                            // Á¨¨‰∫åÁ±ªËøûÊé•ÔºöÊü±Áä∂ÂùóÂà∞ÂéüÂßãÊñáÁ´†ÊÆµËêΩ
                            const barRect = bar.getElementsByClassName('bar')[0].getBoundingClientRect();
                            const paragraphElementRect = paragraphElement.getBoundingClientRect();
                            if (
                                this.isElementInModuleViewport(barRect, tabElement) &&
                                this.isElementInModuleViewport(paragraphElementRect, originalarticlesElement)
                            ) {
                                secondaryConnections.push({
                                    x1: barRect.right + 115, // Êü±Áä∂ÂùóÂè≥Á´Ø,ÁïôÂá∫Ê†áÊ≥®‰ΩçÁΩÆ
                                    y1: barRect.top + barRect.height / 2,
                                    x2: paragraphElementRect.left, // ÂéüÂßãÊñáÁ´†ÊÆµËêΩÂ∑¶Á´Ø
                                    y2: paragraphElementRect.top + paragraphElementRect.height / 2,
                                    articleId,
                                    paragraphIndex,
                                });
                            }
                        }


                    });



                    // ÁªòÂà∂Êõ≤Á∫ø
                    const svg = d3.select('#connection-lines');
                    connections.forEach(connection => {
                        svg
                            .append('path')
                            .attr('d', this.generatePath(connection))
                            .attr('stroke', '#ccc') // ÈªòËÆ§ÁÅ∞Ëâ≤
                            .attr('stroke-width', 2)
                            .attr('fill', 'none')
                            .attr('data-article-id', connection.articleId)
                            .attr('data-paragraph-index', connection.paragraphIndex)
                            .classed('connection-line', true);
                    });
                    // ÁªòÂà∂Ê¨°ËøûÊé•ÔºöÊü±Áä∂ÂùóÂà∞ÂéüÂßãÊñáÁ´†ÊÆµËêΩ
                    secondaryConnections.forEach(connection => {
                        svg
                            .append('path')
                            .attr('d', this.generatePath(connection))
                            .attr('stroke', '#888') // ‰ΩøÁî®‰∏çÂêåÈ¢úËâ≤Âå∫ÂàÜÊ¨°ËøûÊé•
                            .attr('stroke-width', 1.5) // Ê¨°ËøûÊé•Á∫øÊù°Áï•ÁªÜ
                            .attr('fill', 'none')
                            .attr('data-article-id', connection.articleId)
                            .attr('data-paragraph-index', connection.paragraphIndex)
                            .classed('connection-line', true); // Ê¨°ËøûÊé•Ê†∑Âºè
                    });
                }


            });
        },
        // Âà§Êñ≠ÂÖÉÁ¥†ÊòØÂê¶Âú®ÂèØËßÜÂå∫Âüü
        isElementInModuleViewport(elementRect, moduleElement) {
            const moduleRect = moduleElement.getBoundingClientRect();

            return (
                elementRect.bottom - elementRect.height / 2 > moduleRect.top && // ÂÖÉÁ¥†ÁöÑÂ∫ïÈÉ®Ë∂ÖËøáÂÆπÂô®È°∂ÈÉ®
                elementRect.top + elementRect.height / 2 < moduleRect.bottom && // ÂÖÉÁ¥†ÁöÑÈ°∂ÈÉ®Âú®ÂÆπÂô®Â∫ïÈÉ®‰ª•‰∏ä
                elementRect.right > moduleRect.left && // ÂÖÉÁ¥†ÁöÑÂè≥ËæπË∂ÖËøáÂÆπÂô®Â∑¶‰æß
                elementRect.left < moduleRect.right // ÂÖÉÁ¥†ÁöÑÂ∑¶ËæπÂú®ÂÆπÂô®Âè≥‰æß‰ª•ÂÜÖ
            );
        },
        generatePath({ x1, y1, x2, y2 }) {
            // ‰ΩøÁî®Ë¥ùÂ°ûÂ∞îÊõ≤Á∫øÁîüÊàêË∑ØÂæÑ
            const cx = (x1 + x2) / 2; // ÊéßÂà∂ÁÇπÁöÑ x ÂùêÊ†á
            return `M ${x1},${y1} C ${cx},${y1} ${cx},${y2} ${x2},${y2}`;
        },
        highlightConnection(articleId, paragraphIndex = null) {
            // ÈáçÁΩÆÊâÄÊúâÊõ≤Á∫øÊ†∑Âºè
            d3.selectAll('.connection-line')
                .attr('stroke', '#ccc') // ÊÅ¢Â§çÈªòËÆ§ÁÅ∞Ëâ≤
                .attr('stroke-width', 2);

            if (this.activeTab === 'analysisAngles') {
                if (paragraphIndex === null) {
                    d3.selectAll(`.connection-line[data-article-id="${articleId}"]`)
                        .attr('stroke', '#555')
                        .attr('stroke-width', 4);
                } else {
                    d3.selectAll(
                        `.connection-line[data-article-id="${articleId}"][data-paragraph-index="${paragraphIndex}"]`
                    )
                        .attr('stroke', '#555')
                        .attr('stroke-width', 4);
                }
            } else if (this.activeTab === 'paragraphComparison') {
                if (paragraphIndex === null) {
                    d3.selectAll(`.connection-line[data-article-id="${articleId}"]`)
                        .attr('stroke', '#555')
                        .attr('stroke-width', 4);
                } else {
                    d3.selectAll(
                        `.connection-line[data-article-id="${articleId}"][data-paragraph-index="${paragraphIndex}"]`
                    )
                        .attr('stroke', '#555')
                        .attr('stroke-width', 4);
                }
            }
        },
        removeHighlight() {
            // ÊÅ¢Â§çÈªòËÆ§Ê†∑Âºè
            d3.selectAll('.connection-line')
                .attr('stroke', '#ccc')
                .attr('stroke-width', 2);
        },
        handleScroll() {
            console.log("Scroll detected, redrawing connections...");
            // ÊØèÊ¨°ÊªöÂä®ÂêéÂà∑Êñ∞Êõ≤Á∫ø
            if (this.connectionsVisible) {
                this.drawConnections();
            }
        },
        // ÂàáÊç¢ËøûÊé•Á∫øÁöÑÊòæÁ§∫/ÈöêËóèÁä∂ÊÄÅ
        toggleConnectionsVisibility() {
            this.connectionsVisible = !this.connectionsVisible;

            if (this.connectionsVisible) {
                this.drawConnections(); // Â¶ÇÊûúÈúÄË¶ÅÊòæÁ§∫ÔºåÈáçÊñ∞ÁªòÂà∂ËøûÊé•Á∫ø
            } else {
                this.clearAllConnections(); // Â¶ÇÊûúÈúÄË¶ÅÈöêËóèÔºåÊ∏ÖÈô§ËøûÊé•Á∫ø
            }
        },
        // Ê∏ÖÈô§ÊâÄÊúâËøûÊé•Á∫ø
        clearAllConnections() {
            d3.select('#connection-lines').selectAll('*').remove();
        },
        // Ê†ºÂºèÂåñÂèëÂ∏ÉÊó∂Èó¥
        formatPublishedAt(isoDate) {
            const date = new Date(isoDate);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true,
            });
        },
        // Â§ÑÁêÜÈòÖËØªÁä∂ÊÄÅÊîπÂèò
        handleReadStatusChange(article) {
            if (article.isRead) {
                console.log(`Article ${article.id} marked as read.`);
            } else {
                console.log(`Article ${article.id} marked as unread.`);
            }

            // ÈáçÊñ∞ËÆ°ÁÆóÊâÄÊúâÊú™ËØªÊñáÁ´†ÁöÑÈáçÂ§çÁéá
            this.updateRepetitionRates();
            this.updateComprehensiveScores();

        },

        // Êõ¥Êñ∞Êú™ËØªÊñáÁ´†ÁöÑÈáçÂ§çÁéá
        updateRepetitionRates() {
            const readArticles = this.articles.filter(a => a.isRead); // Â∑≤ËØªÊñáÁ´†ÂàóË°®
            const hasReadArticles = readArticles.length > 0;

            this.articles.forEach(article => {
                if (!article.isRead && hasReadArticles) {
                    // ËÆ°ÁÆóÊú™ËØªÊñáÁ´†ÁöÑÈáçÂ§çÁéá
                    article.repetitionRate = this.calculateRepetitionRate(article, readArticles);
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÂ∑≤ËØªÊñáÁ´†ÔºåÂàôËÆæÁΩÆÈáçÂ§çÁéá‰∏∫ null
                    article.repetitionRate = null;
                }
            });
            // Â¶ÇÊûúÂΩìÂâçÊéíÂ∫èÊñπÂºèÊòØÈáçÂ§çÁéáÔºåÂàôÈáçÊñ∞ÊéíÂ∫è
            if (this.sortOrder === 'repetitionRate') {
                this.articles.sort((a, b) => {
                    if (a.repetitionRate === null) return 1; // Â∞ÜÊ≤°ÊúâÈáçÂ§çÁéáÁöÑÊñáÁ´†ÊéíÂú®ÂêéÈù¢
                    if (b.repetitionRate === null) return -1;
                    return a.repetitionRate - b.repetitionRate; // ‰ΩéÈáçÂ§çÁéá‰ºòÂÖà
                });
            }

        },

        // ËÆ°ÁÆóÂçïÁØáÊñáÁ´†ÁöÑÈáçÂ§çÁéá
        calculateRepetitionRate(article, readArticles) {
            if (!readArticles || readArticles.length === 0) {
                return null; // Ê≤°ÊúâÂ∑≤ËØªÊñáÁ´†Êó∂ÔºåËøîÂõû null
            }

            // Ëé∑ÂèñÊú™ËØªÊñáÁ´†ÁöÑÊÆµËêΩÂîØ‰∏Ä ID ÂàóË°®
            const unreadParagraphs = article.paragraphs.map((p, index) => `${article.id}_p${index + 1}`);


            // 1. ÊûÑÂª∫Â∑≤ËØªÊñáÁ´†ÁöÑÊÆµËêΩÊåâËßíÂ∫¶ÂàÜÁ±ª
            const angleParagraphs = {}; // Áî®‰∫éÂ≠òÂÇ®ÊåâËßíÂ∫¶ÂàÜÁ±ªÁöÑÂ∑≤ËØªÊÆµËêΩ ID
            for (const angleId in this.similarities) {
                angleParagraphs[angleId] = []; // ÂàùÂßãÂåñÊØè‰∏™ËßíÂ∫¶ÁöÑÊÆµËêΩÊï∞ÁªÑ
            }

            readArticles.forEach(readArticle => {
                readArticle.paragraphs.forEach((p, index) => {
                    const paragraphId = `${readArticle.id}_p${index + 1}`; // Â∑≤ËØªÊÆµËêΩÁöÑÂîØ‰∏Ä ID

                    for (const angleId in this.clusteredParagraphs) {
                        // Ê£ÄÊü•ËØ•ÊÆµËêΩÊòØÂê¶Â±û‰∫éÊüê‰∏™ËßíÂ∫¶
                        if (
                            this.clusteredParagraphs[angleId].some(clusteredParagraph => clusteredParagraph.unique_id === paragraphId)
                        ) {
                            angleParagraphs[angleId].push(paragraphId); // Â∞ÜÊÆµËêΩ ID Ê∑ªÂä†Âà∞ÂØπÂ∫îËßíÂ∫¶
                        }
                    }
                });
            });


            // 2. ËÆ°ÁÆóÊú™ËØªÊñáÁ´†ÁöÑÁõ∏‰ººÊÄßÂàÜÊï∞
            let totalSimilarity = 0;
            unreadParagraphs.forEach(unreadParagraphId => {
                let maxSimilarity = 0; // ÂΩìÂâçÊÆµËêΩÁöÑÊúÄÂ§ßÁõ∏‰ººÊÄßÂàÜÊï∞

                // Á°ÆÂÆöÊú™ËØªÊÆµËêΩÊâÄÂú®ÁöÑËßíÂ∫¶
                const paragraphAngleId = Object.keys(this.clusteredParagraphs).find(angleId =>
                    this.clusteredParagraphs[angleId].some(clusteredParagraph => clusteredParagraph.unique_id === unreadParagraphId)
                );

                if (paragraphAngleId) {
                    // Ëé∑ÂèñËØ•ËßíÂ∫¶ÁöÑÊâÄÊúâÂ∑≤ËØªÊÆµËêΩ
                    const angleParagraphsSet = angleParagraphs[paragraphAngleId] || [];

                    // ËÆ°ÁÆóËØ•ÊÆµËêΩ‰∏éÂΩìÂâçËßíÂ∫¶ÁöÑÊúÄÂ§ßÁõ∏‰ººÊÄß
                    maxSimilarity = angleParagraphsSet.reduce((maxSim, readParagraphId) => {
                        const similarity = this.getSimilarityScore(unreadParagraphId, readParagraphId);
                        // console.log(`Similarity between ${unreadParagraphId} and ${readParagraphId}: ${similarity}`);
                        return Math.max(maxSim, similarity); // ÂèñÊúÄÂ§ßÂÄº
                    }, 0);
                }

                totalSimilarity += maxSimilarity; // Âä†ÂÖ•ÊñáÁ´†ÁöÑÊÄªÁõ∏‰ººÊÄß
            });


            // 3. ÂΩí‰∏ÄÂåñÁõ∏‰ººÊÄßÂàÜÊï∞
            const repetitionRate = totalSimilarity / unreadParagraphs.length; // Âπ≥ÂùáÁõ∏‰ººÊÄß


            return repetitionRate;
        },

        // Ëé∑Âèñ‰∏§‰∏™ÊÆµËêΩÁöÑÁõ∏‰ººÊÄßÂàÜÊï∞
        getSimilarityScore(paragraph1, paragraph2) {
            for (const angleId in this.similarities) {
                const similarityData = this.similarities[angleId];
                const match = similarityData.find(similarity =>
                    (similarity.paragraph_1_id === paragraph1 && similarity.paragraph_2_id === paragraph2) ||
                    (similarity.paragraph_2_id === paragraph1 && similarity.paragraph_1_id === paragraph2)
                );
                if (match) {
                    return match.similarity;
                }
            }
            return 0; // Â¶ÇÊûúÊ≤°ÊúâÁõ∏‰ººÊÄßÔºåËøîÂõû 0
        },
        // Êõ¥Êñ∞ÁªºÂêàÂæóÂàÜ
        updateComprehensiveScores() {
            const readArticles = this.articles.filter(a => a.isRead); // Â∑≤ËØªÊñáÁ´†ÂàóË°®
            const hasReadArticles = readArticles.length > 0;

            this.articles.forEach(article => {
                if (!article.isRead && hasReadArticles) {
                    // ËÆ°ÁÆóÊú™ËØªÊñáÁ´†ÁöÑÈáçÂ§çÁéá
                    article.comprehensiveScore = this.calculateComprehensiveScore(article);
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÂ∑≤ËØªÊñáÁ´†ÔºåÂàôËÆæÁΩÆÈáçÂ§çÁéá‰∏∫ null
                    article.comprehensiveScore = null;
                }
            });
            // Â¶ÇÊûúÂΩìÂâçÊéíÂ∫èÊñπÂºèÊòØÁªºÂêàÂæóÂàÜÔºåÂàôÈáçÊñ∞ÊéíÂ∫è
            if (this.sortOrder === 'comprehensiveScore') {
                this.articles.sort((a, b) => b.comprehensiveScore - a.comprehensiveScore);
            }
        },
        // ËÆ°ÁÆóÁªºÂêàÂæóÂàÜ
        calculateComprehensiveScore(article) {
            const repetitionRate = article.repetitionRate != null && !isNaN(article.repetitionRate)
                ? article.repetitionRate
                : 1; // ÂÅáËÆæÊúÄÂ§ßÈáçÂ§çÁéá‰∏∫ 1

            const recommendationWeight = this.weights.recommendation;
            const repetitionWeight = 1 - recommendationWeight;

            // ÁªºÂêàÂæóÂàÜÂÖ¨Âºè
            return (
                recommendationWeight * article.recommendationScore -
                repetitionWeight * (1 - repetitionRate)
            );
        },

        // ÂàáÊç¢ËßíÂ∫¶ÂàÜÊûê‰∏≠Êü±Áä∂ÂùóÁöÑÈöêËóèÁä∂ÊÄÅ
        toggleHideUnmatchedBars() {
            this.hideUnmatchedBars = !this.hideUnmatchedBars;
        },
        // ËøáÊª§ÊñáÁ´†ÂàóË°®‰∏≠ÂåÖÂê´ÁöÑÊÆµËêΩ
        filteredParagraphs(paragraphs) {
            if (!this.hideUnmatchedBars) {
                return paragraphs; // Â¶ÇÊûú‰∏çÈöêËóèÔºåËøîÂõûÊâÄÊúâÊÆµËêΩ
            }

            // Â¶ÇÊûúÈöêËóèÊú™ÂåπÈÖçÊÆµËêΩÔºåËøáÊª§ÊéâÊ≤°ÊúâÂØπÂ∫îÊñáÁ´†ÁöÑÊÆµËêΩ
            return paragraphs.filter(paragraph => {
                const articleElement = document.getElementById(`article-${paragraph.article_id}`);
                return !!articleElement; // Âè™‰øùÁïôÊúâÂØπÂ∫îÊñáÁ´†ÁöÑÊÆµËêΩ
            });
        },

        handleTextSelection(articleId, paragraphIndex) {
            const selection = window.getSelection();

            if (!selection || selection.isCollapsed) return;

            const range = selection.getRangeAt(0);
            const startContainer = range.startContainer;
            const endContainer = range.endContainer;

            const paragraphElement = document.getElementById(`paragraph-${articleId}-${paragraphIndex}`);
            if (!paragraphElement.contains(startContainer) || !paragraphElement.contains(endContainer)) {
                alert("Highlight must be within a single paragraph.");
                return;
            }

            // Â≠òÂÇ® Range ‰ø°ÊÅØ
            this.selectionRange = range;
            this.startContainer = startContainer; // ‰øùÂ≠ò startContainer
            this.endContainer = endContainer; // ‰øùÂ≠ò endContainer
            this.highlightparagraphElement = document.getElementById(`paragraph-${articleId}-${paragraphIndex}`);

            // Ëé∑ÂèñÁî®Êà∑ÈÄâ‰∏≠ÊñáÊú¨ÁöÑÂùêÊ†á
            const rect = range.getBoundingClientRect();
            this.highlightButtonPosition = {
                x: rect.right + 8, // Â¢ûÂä†‰∏Ä‰∫õÈó¥Ë∑ùÔºåËÆ©ÊåâÈíÆ‰∏çÁõ¥Êé•Ë¥¥ÁùÄÊñáÊú¨
                y: rect.top + window.scrollY - 16 // Ë∞ÉÊï¥ÂûÇÁõ¥‰ΩçÁΩÆÔºåËÆ©ÊåâÈíÆÂ±Ö‰∏≠ÂØπÈΩê
            };
            this.highlightButtonVisible = true; // ÊòæÁ§∫È´ò‰∫ÆÊåâÈíÆ
            this.$nextTick(() => {
                console.log("Highlight button position updated:", this.highlightButtonPosition);
            });

        },
        applyHighlight(articleId, paragraphIndex) {
            if (!this.selectionRange || !this.startContainer || !this.endContainer) {
                console.error("No valid selection range or containers.");
                return;
            }

            const range = this.selectionRange;
            const startContainer = this.startContainer;
            const endContainer = this.endContainer;

            // Helper function to get all text nodes within a paragraph (skipping <br>)
            const getAllTextNodes = (node) => {
                const textNodes = [];
                if (node.nodeType === Node.TEXT_NODE) {
                    textNodes.push(node);
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    // ÂøΩÁï• <br> Ê†áÁ≠æÔºå‰ΩÜÈÄíÂΩíÂ§ÑÁêÜÂ≠êËäÇÁÇπ
                    node.childNodes.forEach((child) => {
                        textNodes.push(...getAllTextNodes(child));
                    });
                }
                return textNodes;
            };


            const paragraphElement = this.highlightparagraphElement;
            const textNodes = getAllTextNodes(paragraphElement);

            let charCount = 0; // Tracks the cumulative character count
            let startOffset = null;
            let endOffset = null;
            // ÈÅçÂéÜÊñáÊú¨ËäÇÁÇπÔºåËÆ°ÁÆóËµ∑ÂßãÂíåÁªìÊùüÂÅèÁßªÈáè
            for (const node of textNodes) {
                const nodeLength = node.textContent.length;

                // Á°ÆÂÆö startOffset
                if (startOffset === null && node === startContainer) {
                    startOffset = charCount + range.startOffset;
                }
                // Á°ÆÂÆö endOffset
                if (endOffset === null && node === endContainer) {
                    endOffset = charCount + range.endOffset;
                }

                charCount += nodeLength;

                // Â¶ÇÊûú startOffset Âíå endOffset ÈÉΩÂ∑≤ÊâæÂà∞ÔºåÂàôÈÄÄÂá∫Âæ™ÁéØ
                if (startOffset !== null && endOffset !== null) break;
            }

            const highlightText = range.toString();
            // let annotation = prompt("Add a note for the selected text (leave blank if no note):");
            // if (annotation === null) annotation = ""; // Allow blank annotation for just highlighting
            // annotation = "";

            const highlightData = {
                text: highlightText,
                startOffset,
                endOffset,
                // annotation,
                paragraphIndex,
            };

            if (!this.highlights[articleId]) {
                this.highlights[articleId] = [];
            }
            this.highlights[articleId].push(highlightData);


            // Render highlight immediately
            this.renderHighlight(articleId, highlightData);
            // ÈöêËóèÈ´ò‰∫ÆÊåâÈíÆ
            this.highlightButtonVisible = false;
            this.selectionRange = null;

            // Clear selection
            window.getSelection().removeAllRanges();


        },
        renderHighlight(articleId, highlightData) {
            console.log(articleId, highlightData);
            // Ëé∑ÂèñÂØπÂ∫îÊÆµËêΩÁöÑ DOM ÂÖÉÁ¥†
            const paragraphElement = this.highlightparagraphElement;
            if (!paragraphElement) return;

            // Ëé∑ÂèñÊÆµËêΩ‰∏≠ÁöÑÊâÄÊúâÊñáÊú¨ËäÇÁÇπ
            const getAllTextNodes = (node) => {
                const textNodes = [];
                if (node.nodeType === Node.TEXT_NODE) {
                    textNodes.push(node);
                } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName !== "BR") {
                    node.childNodes.forEach((child) => {
                        textNodes.push(...getAllTextNodes(child));
                    });
                }
                return textNodes;
            };

            const textNodes = getAllTextNodes(paragraphElement);
            let charCount = 0;
            let rangeStart = null;
            let rangeEnd = null;

            // ÈÅçÂéÜÊâÄÊúâÊñáÊú¨ËäÇÁÇπÔºåÊâæÂà∞ `startOffset` Âíå `endOffset` ÊâÄÂú®ÁöÑËäÇÁÇπÂèäÂÅèÁßª
            for (const node of textNodes) {
                const nodeLength = node.textContent.length;

                if (!rangeStart && charCount + nodeLength > highlightData.startOffset) {
                    rangeStart = { node, offset: highlightData.startOffset - charCount };
                }
                if (!rangeEnd && charCount + nodeLength > highlightData.endOffset) {
                    rangeEnd = { node, offset: highlightData.endOffset - charCount };
                }

                charCount += nodeLength;
                if (rangeStart && rangeEnd) break;
            }

            if (!rangeStart || !rangeEnd) {
                console.error("Failed to calculate the correct range for highlighting.");
                return;
            }

            const range = document.createRange();
            try {
                range.setStart(rangeStart.node, rangeStart.offset);
                range.setEnd(rangeEnd.node, rangeEnd.offset);

                // ÂàõÂª∫È´ò‰∫ÆÁöÑ <span> ÂÖÉÁ¥†
                const highlightSpan = document.createElement("span");
                highlightSpan.classList.add("highlight");
                highlightSpan.style.backgroundColor = "yellow";

                // Â¶ÇÊûúÊúâÊ≥®ÈáäÔºåÊ∑ªÂä†Ê≥®ÈáäÊï∞ÊçÆÂ±ûÊÄß
                if (highlightData.annotation) {
                    highlightSpan.setAttribute("data-annotation", highlightData.annotation);
                }

                // Áî® DocumentFragment ÊèêÂèñÂÜÖÂÆπÂπ∂ÂåÖË£π
                const fragment = range.extractContents();
                highlightSpan.appendChild(fragment);
                range.insertNode(highlightSpan);

                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂‰ª•Âà†Èô§È´ò‰∫Æ
                highlightSpan.addEventListener("click", () => {
                    if (confirm("Do you want to remove this highlight?")) {
                        const parent = highlightSpan.parentNode;
                        while (highlightSpan.firstChild) {
                            parent.insertBefore(highlightSpan.firstChild, highlightSpan);
                        }
                        parent.removeChild(highlightSpan);

                        this.highlights[articleId] = this.highlights[articleId].filter(
                            (h) =>
                                h.startOffset !== highlightData.startOffset ||
                                h.endOffset !== highlightData.endOffset ||
                                h.paragraphIndex !== highlightData.paragraphIndex
                        );
                    }
                });
            } catch (error) {
                console.error("Error during surroundContents:", error);
            }
        },
        logDebug(message) {
            console.log('[DEBUG]:', message);
        }

    },
    mounted() {
        this.loadData();
        // ÁªòÂà∂ÊñáÁ´†Âà∞ÊÆµËêΩÂùóÁöÑÊõ≤Á∫ø
        // ÁªòÂà∂Êõ≤Á∫øÂπ∂ÁõëÂê¨ÊªöËΩÆ‰∫ã‰ª∂
        this.$nextTick(() => {
            const resizer = document.querySelector(".resizer");
            const leftPanel = document.querySelector("#analysis-paragraph-tabs");
            const rightPanel = document.querySelector("#original-article");
            const fixedLeftPanel = document.querySelector("#article-list"); // Â∑¶‰æßÂõ∫ÂÆöÂÆΩÂ∫¶Ê®°Âùó

            resizer.addEventListener("mousedown", () => {
                this.isDragging = true;
                document.body.style.cursor = "ew-resize";
                document.body.style.userSelect = "none";
            });

            document.addEventListener("mousemove", (e) => {
                if (!this.isDragging) return;

                const containerWidth = document.querySelector("#main-content").offsetWidth;

                // Ëé∑ÂèñÈº†Ê†á‰ΩçÁΩÆÂπ∂ËÆ°ÁÆó‰∏≠Èó¥ÂíåÂè≥‰æßÁöÑÂÆΩÂ∫¶
                const leftWidth = fixedLeftPanel.offsetWidth; // Â∑¶‰æßÂõ∫ÂÆöÂÆΩÂ∫¶
                const middleWidth = e.clientX - leftWidth; // ‰∏≠Èó¥ÁöÑÂÆΩÂ∫¶
                const rightWidth = containerWidth - middleWidth - leftWidth - 5; // Âè≥‰æßÂÆΩÂ∫¶ÔºàÂáèÂéªÂàÜÂâ≤Âô®Ôºâ

                // ÈôêÂà∂‰∏≠Èó¥ÂíåÂè≥‰æßÁöÑÊúÄÂ∞èÂÆΩÂ∫¶
                if (middleWidth < 200 || rightWidth < 200) return;

                // Ë∞ÉÊï¥‰∏≠Èó¥ÂíåÂè≥‰æßÊ®°ÂùóÁöÑÂÆΩÂ∫¶
                leftPanel.style.flexGrow = 0;
                rightPanel.style.flexGrow = 0;
                leftPanel.style.width = `${middleWidth}px`;
                rightPanel.style.width = `${rightWidth}px`;
            });

            document.addEventListener("mouseup", () => {
                this.isDragging = false;
                document.body.style.cursor = "";
                document.body.style.userSelect = "";
            });

            // ÁªòÂà∂Êõ≤Á∫ø
            if (this.connectionsVisible) {
                this.drawConnections();
            }

            // ÁõëÂê¨ Articles Âíå Paragraph Comparison ÁöÑÊªöËΩÆ‰∫ã‰ª∂
            const articlesElement = document.getElementById("article-list");
            // const comparisonElement = document.getElementById("paragraph-comparison");
            const tabElement = document.getElementById('analysis-paragraph-tabs');
            const originalarticlesElement = document.getElementById('original-article');

            if (articlesElement) {
                articlesElement.addEventListener("scroll", this.handleScroll);
            }
            // if (comparisonElement) {
            //     comparisonElement.addEventListener("scroll", this.handleScroll);
            // }
            if (tabElement) {
                tabElement.addEventListener('scroll', this.handleScroll);
            }
            if (originalarticlesElement) {
                originalarticlesElement.addEventListener('scroll', this.handleScroll);
            }
        });

    },
    updated() {
        // ÁªòÂà∂ÊñáÁ´†Âà∞ÊÆµËêΩÂùóÁöÑÊõ≤Á∫ø
        if (this.connectionsVisible) {
            this.drawConnections();
        }

    },
    beforeDestroy() {
        // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨
        const articlesElement = document.getElementById("article-list");
        // const comparisonElement = document.getElementById("paragraph-comparison");
        const tabElement = document.getElementById('analysis-paragraph-tabs');

        if (articlesElement) {
            articlesElement.removeEventListener("scroll", this.handleScroll);
        }
        // if (comparisonElement) {
        //     comparisonElement.removeEventListener("scroll", this.handleScroll);

        // }
        if (tabElement) {
            tabElement.removeEventListener('scroll', this.handleScroll);
        }
        if (originalarticlesElement) {
            originalarticlesElement.removeEventListener('scroll', this.handleScroll);
        }
    },
};

</script>


<style lang="scss">
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    height: 100vh;
    background-color: #f8f9fa;
    overflow: hidden;

}

#app {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}


#main-content {
    // display: grid;
    // grid-template-columns: 1fr 1fr 2fr;
    display: flex;
    /* ÂàáÊç¢Âà∞ Flexbox Â∏ÉÂ±Ä */
    flex-direction: row;
    /* Ê∞¥Âπ≥ÊéíÂàóÊ®°Âùó */
    // height: 84%;
    overflow: hidden;
}

.module {
    border: 1px solid #ddd;
    background-color: #fff;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow-y: auto;
    padding: 10px;

    flex-grow: 1;
    /* Ê®°ÂùóÂèØ‰ª•Êâ©Â±ï */
    min-width: 0;
    /* Èò≤Ê≠¢Ê®°ÂùóÂÜÖÂÆπÊ∫¢Âá∫ÂØºËá¥Â∏ÉÂ±ÄÈóÆÈ¢ò */
    transition: flex-grow 0.2s ease;
    /* Ê∑ªÂä†Âπ≥ÊªëÂä®Áîª */
}

.module h2 {
    font-size: 20px;
    margin-bottom: 10px;
    color: #333;
}

/* ÂàÜÂâ≤Âô® */
.resizer {
    width: 5px;
    /* ÂàÜÂâ≤Âô®ÂÆΩÂ∫¶ */
    cursor: ew-resize;
    /* ÊîπÂèòÈº†Ê†á‰∏∫Ê∞¥Âπ≥ÊãñÊãΩÊ†∑Âºè */
    background-color: #ccc;
    /* ÂàÜÂâ≤Âô®ÁöÑÈ¢úËâ≤ */
    z-index: 10;
    flex-shrink: 0;
    /* ÂàÜÂâ≤Âô®‰∏çÂÖÅËÆ∏Áº©Â∞è */
}


#article-list {
    overflow-y: auto;
    flex-shrink: 0;
    /* Èò≤Ê≠¢Ëá™Âä®Áº©Â∞èÂÆΩÂ∫¶ */
    width: 25%;
    height: 100%;
}


#analysis-paragraph-tabs {
    overflow-y: auto;
    width: 50%;
    height: 100%;
}


#original-article {
    overflow-y: auto;
    width: 25%;
    height: 100%;
}

/* ËÆ©ÊñáÁ´†ÁöÑÊªöÂä®Êù°Âú®Â∑¶‰æß */
#article-list {
    direction: rtl;
}

#article-list>* {
    direction: ltr;
}


// ÈÄâÈ°πÂç°Ê†∑Âºè
#analysis-paragraph-tabs {
    h2 {
        display: flex;
        justify-content: space-around;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border-radius: 8px;
        margin-bottom: 10px;
        font-size: 2rem;
    }

    h2 button {
        flex: 1;
        padding: 10px;
        border: none;
        cursor: pointer;
        background-color: #f8f9fa;
        font-weight: bold;
        color: #5c6167;
        transition: background-color 0.3s, color 0.3s;
    }

    h2 button:hover {
        background-color: #5c6167;
        color: #fff;
    }

    h2 button.active {
        background-color: #5c6167;
        color: #fff;
    }

}


/* Settings Ê®°ÂùóÊï¥‰ΩìÊ†∑Âºè */

#settings {
    overflow-y: visible;
    background-color: #f9f9f9;
    border: 1px solid hsl(0, 0%, 88%);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    font-family: 'Arial', sans-serif;

    .settings-module {
        display: flex;
        flex-direction: row;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;

        .setting-group {
            // flex: 1 1 calc(50% - 20px);
            padding: 5px 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .setting-group h3 {
            font-size: 1rem;
            color: #444;
            margin-bottom: 10px;
            text-align: left;
            border-bottom: 1px solid hsl(0, 0%, 88%);
            padding-bottom: 5px;
        }

        .setting-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        //  Dropdown Styling 
        .dropdown {
            // width: 100%;
            padding: 8px 12px;
            font-size: 1rem;
            color: #333;
            border: 1px solid hsl(0, 0%, 88%);
            border-radius: 4px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            background-color: #f9f9f9;
            transition: border-color 0.2s ease;
        }

        .dropdown:focus {
            border-color: hsl(200, 80%, 60%);
            outline: none;
        }

        .angles-container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .color-tag {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .color-tag:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .color-tag.selected {
            border: 2px solid hsl(200, 52%, 12%);
        }

        .filter-status,
        .sort-options {
            display: flex;
            flex-direction: row;
            align-items: center;
            flex-wrap: wrap;
        }

        .weight-settings {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weight-slider label {
            font-size: 0.9rem;
            color: #555;
        }

        .weight-slider input[type="range"] {
            flex: 1;
            margin: 0 10px;
            cursor: pointer;
        }
    }


}

/* Settings Ê®°ÂùóÊï¥‰ΩìÊ†∑Âºè---ÁªìÊùü */




/* ÊñáÁ´†ÂàóË°®Ê†∑Âºè */

.article-card {
    margin-right: 50px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #fff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
    /* Ê∑ªÂä†ËøáÊ∏°ÊïàÊûú */
    cursor: pointer;
}

.article-card.active {
    background-color: rgba(0, 0, 0, 0.05);
    /* ËÉåÊôØËâ≤Âä†Ê∑± */
}

.article-card:hover {
    transform: translateY(-5px);
    /* ÊÇ¨ÂÅúÊó∂ÊèêÂçáÊïàÊûú */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    /* ÊÇ¨ÂÅúÊó∂Êõ¥Ê∑±ÁöÑÈò¥ÂΩ± */
}

.article-title {
    font-size: 18px;
    /* Ê†áÈ¢òÂ≠ó‰ΩìÂ§ßÂ∞è */
    font-weight: bold;
    /* Âä†Á≤ó */
    color: #333;
    /* Ê†áÈ¢òÈ¢úËâ≤ */
    margin-bottom: 10px;
    /* Ê†áÈ¢ò‰∏éÂÖÉ‰ø°ÊÅØ‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

.article-meta {
    font-size: 14px;
    /* ÂÖÉ‰ø°ÊÅØÂ≠ó‰ΩìÂ§ßÂ∞è */
    color: #555;
    /* ÂÖÉ‰ø°ÊÅØÈ¢úËâ≤ */
    display: flex;
    gap: 10px;
    /* ÂÖÉ‰ø°ÊÅØ‰πãÈó¥ÁöÑÈó¥Ë∑ù */
    margin-bottom: 10px;
    /* ‰∏éÊÆµËêΩÊü±Áä∂Âõæ‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

.article-meta span {
    display: flex;
    align-items: center;
    /* ÂõæÊ†á‰∏éÊñáÂ≠óÂØπÈΩê */
}

.article-meta span::before {
    content: '';
    /* ÂõæÊ†áÂç†‰Ωç */
    display: inline-block;
    margin-right: 5px;
    /* ÂõæÊ†á‰∏éÊñáÂ≠óÈó¥Ë∑ù */
}

.bar-chart {
    display: flex;
    align-items: center;
    gap: 2px;
    /* ÊØè‰∏™Êü±Áä∂Âùó‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

.bar-chart .bar {
    height: 10px;
    margin: 1px;
    border-radius: 3px;
    /* Ê∑ªÂä†ÂúÜËßí */
    cursor: pointer;
    transition: transform 0.2s ease;
    /*s ÊÇ¨ÂÅúÂä®Áîª */
}

.bar-chart .bar:hover {
    transform: scaleY(1.8);
    /* ÊÇ¨ÂÅúÊó∂ÊîæÂ§ß */
}

/* ÈòÖËØªÂÆåÊàêÁöÑËÉåÊôØÂèòÁÅ∞ */
.article-card.read {
    background-color: #e9ecef;
    /* ÊµÖÁÅ∞ËÉåÊôØ */
    border: 1px solid #ccc;
    color: #6c757d;
    /* ÊµÖÁÅ∞Â≠ó‰Ωì */
}

.article-card.read .article-title {
    color: #6c757d;
    /* Ê†áÈ¢òÂ≠ó‰ΩìÈ¢úËâ≤ÂèòÁÅ∞ */
}

/* ====== */

.analysis-angle {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 5px;
    background-color: #f8f9fa;
    cursor: pointer;
    transition: background-color 0.2s;
    position: relative;

    .analysis-angle:hover {
        background-color: #eef;
    }

    .analysis-angle h3 {
        font-size: 16px;
        color: #444;
    }

    .analysis-angle p {
        margin: 10px 0 0;
        font-size: 14px;
        color: #666;
        display: none;
    }


    .angle-paragraph-count {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #007bff;
        color: white;
        font-size: 12px;
        padding: 5px 10px;
        border-radius: 12px;
    }

    /* Êï¥‰ΩìÂÆπÂô®Ê†∑Âºè */
    .angle-summary,
    .word-count-bar-chart-container {
        // margin: 5px 0;
        // padding: 5px;
        // border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

    /* ÊåâÈíÆÊ†∑Âºè */
    .toggle-button {
        display: inline-block;
        font-size: 12px;
        font-weight: bold;
        color: #333;
        background-color: #e7e7e7;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 5px 10px;
        cursor: pointer;
        margin-bottom: 5px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .toggle-button:hover {
        background-color: #d7d7d7;
        color: #111;
    }

    /* ‰∏çÂêåÊåâÈíÆÈ¢úËâ≤ */
    .summary-button {
        background-color: #e6f7ff;
        border-color: #91d5ff;
    }

    .bars-button {
        background-color: #fffbe6;
        border-color: #ffe58f;
    }

    .summary-button:hover {
        background-color: #bae7ff;
        border-color: #40a9ff;
    }

    .bars-button:hover {
        background-color: #fff1b8;
        border-color: #ffc53d;
    }

    /* ÊëòË¶ÅÊñáÂ≠óÊ†∑Âºè */
    .summary-content {
        margin-top: 10px;
        font-size: 14px;
        line-height: 1.6;
        color: #555;
        white-space: pre-wrap;
        /* ‰øùËØÅÊç¢Ë°åÊ≠£Â∏∏ÊòæÁ§∫ */
    }

    // ËßíÂ∫¶Êü±Áä∂Âõæ
    .word-count-bar-chart {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        /* Êü±Áä∂Âùó‰πãÈó¥ÁöÑÈó¥Ë∑ù */

        .bar {
            margin-left: 50px;
        }
    }


}


// ÂéüÂßãÊñáÁ´†Ê†∑Âºè
.paragraph {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f9f9f9;
}

//ÂéüÊñáÈÄâ‰∏≠ÊÆµËêΩËÉåÊôØÂä†Ê∑±
.paragraph.active {
    background-color: rgba(0, 0, 0, 0.05);
    /* ËÉåÊôØËâ≤Âä†Ê∑±ÔºåÈÄèÊòéÂ∫¶ÂèØ‰ª•Ë∞ÉÊï¥ */
    border-left: 7px solid #000;
    /* ‰πüÂèØ‰ª•Êõ¥ÊîπÂ∑¶ËæπÊ°ÜÈ¢úËâ≤ */
}


.paragraph-content {
    flex: 1;
}

.color-tag {
    display: inline-block;
    width: 20px;
    height: 20px;
    margin: 5px;
    border-radius: 3px;
    cursor: pointer;
    transition: transform 0.2s;
    border: 2px solid transparent;
}

.color-tag.selected {
    border-color: #000;
    /* È´ò‰∫ÆËæπÊ°Ü */
    transform: scale(1.1);
    /* ÊîæÂ§ßÊïàÊûú */
}



/* ÈáçÂ§çÁéá */
.bar-container {
    display: flex;
    align-items: center;
    margin: 6px 10px;
    gap: 10px;
    /* Êü±Áä∂ÂùóÂíåÂ≠óÊï∞Ê†áÁ≠æ‰πãÈó¥ÁöÑÈó¥Ë∑ù */
    cursor: pointer;
    transition: transform 0.2s, opacity 0.2s;
    /* Â¢ûÂä†ËøáÊ∏°ÊïàÊûú */
}

.bar-container:hover {
    transform: scale(1.03);

}

.bar-container .bar {
    // width: 90%;
    height: 20px;
    border-radius: 3px;
}

.similarity-label {
    margin-left: 10px;
    /* ‰∏éÊü±Áä∂Âùó‰πãÈó¥ÁöÑÈó¥Ë∑ù */
    font-size: 14px;
    /* Â≠ó‰ΩìÂ§ßÂ∞è */
    color: #333;
    /* Â≠ó‰ΩìÈ¢úËâ≤ */
    white-space: nowrap;
    /* Èò≤Ê≠¢ÊñáÂ≠óÊäòË°å */
}

#paragraph-comparison h3 {
    margin-top: 20px;
    /* ‰∏é‰∏äÊñπÊü±Áä∂Âõæ‰πãÈó¥ÁöÑÈó¥Ë∑ù */
    font-size: 18px;
    /* Ê†áÈ¢òÂ≠ó‰ΩìÂ§ßÂ∞è */
    color: #444;
    /* Ê†áÈ¢òÈ¢úËâ≤ */
}

/* ÊãñÂä®ÊïàÊûú */
.angles-list {
    display: flex;
    flex-direction: column;
    // gap: 10px;
}

.analysis-angle {
    cursor: grab;
    /* ÊòæÁ§∫ÊãñÂä®ÁöÑÊâãÂΩ¢ÊåáÈíà */
    transition: transform 0.2s ease;
    /* ÊãñÂä®Êó∂Âπ≥ÊªëÂä®Áîª */
}

.analysis-angle.dragging {
    opacity: 0.5;
    /* ÊãñÂä®Êó∂ÂçäÈÄèÊòé */
}

.drag-handle {
    cursor: grab;
    user-select: none;
    /* Á¶ÅÊ≠¢ÊñáÊú¨ÈÄâÊã© */
    font-size: 16px;
    display: inline-block;
}

.drag-handle:active {
    cursor: grabbing;
}

.current-angle-title {
    margin-bottom: 15px;
    font-size: 18px;
    font-weight: bold;
    color: #444;
    text-align: center;
}


/* Êõ≤Á∫øÁªòÂà∂ */
#connection-lines {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    /* ‰Ωø SVG Ë¶ÜÁõñÊï¥‰∏™ËßÜÂè£È´òÂ∫¶ */
    pointer-events: none;
    /* Á¶ÅÊ≠¢Èº†Ê†á‰∫ã‰ª∂ */
    z-index: 0;
}

.connection-line {
    transition: stroke 0.2s, stroke-width 0.2s;
}

/* ÊñáÁ´†ÊéíÂ∫èÊñπÂºè */
.sort-options {
    display: flex;
    flex-direction: column;
    /* ÂûÇÁõ¥ÊéíÂàó */
    gap: 10px;
    /* ÊØè‰∏™ÈÄâÈ°π‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

.sort-options label {
    display: flex;
    align-items: center;
    /* ÂûÇÁõ¥Â±Ö‰∏≠ */
    font-size: 14px;
    /* Ë∞ÉÊï¥Â≠ó‰ΩìÂ§ßÂ∞è */
    cursor: pointer;
    /* Èº†Ê†áÊÇ¨ÂÅúÊó∂ÊòæÁ§∫ÊâãÂûãÊåáÈíà */
}

.sort-options input[type="radio"] {
    margin-right: 10px;
    /* ÂçïÈÄâÊ°Ü‰∏éÊñáÂ≠ó‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

/* settingÈáåÊñáÁ´†Áä∂ÊÄÅÂ§çÈÄâ */
.filter-status {
    display: flex;
    flex-direction: column;
    /* ÂûÇÁõ¥ÊéíÂàó */
    gap: 10px;
    /* ÈÄâÈ°π‰πãÈó¥ÁöÑÈó¥Ë∑ù */
}

.filter-status label {
    font-size: 14px;
    cursor: pointer;
}


.word-count-label {
    font-size: 12px;
    color: #666;
    white-space: nowrap;
    /* Èò≤Ê≠¢ÊñáÂ≠óÊäòË°å */
}

// ËßíÂ∫¶ÂàÜÊûêÈáåÁöÑÊü±Áä∂ÂùóÈöêËóèÊåâÈíÆ
.toggle-button {
    margin: 2px 2px;
    z-index: 10;
    padding: 5px 10px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
}

.toggle-button:hover {
    background-color: #0056b3;
}

// ÂéüÂßãÊñáÁ´†È´ò‰∫Æ
.highlight {
    background-color: yellow;
    padding: 0;
    margin: 0;
    display: inline;
    /* Á°Æ‰øù‰∏∫ÂÜÖËÅîÂÖÉÁ¥†Ôºå‰∏çÁ†¥ÂùèÊÆµËêΩÁªìÊûÑ */
    border-radius: 2px;
    /* ÂèØÈÄâÔºåÂúÜËßíÊòæÁ§∫Êõ¥ÁæéËßÇ */
    cursor: pointer;
}

.highlight:hover {
    background-color: orange;
    /* Èº†Ê†áÊÇ¨ÂÅúÊó∂ÔºåÈ¢úËâ≤Á®ç‰ΩúÂèòÂåñ */
}

//Âè•Â≠êÁõ∏‰ººÈ´ò‰∫Æ
.sentence {
    display: inline;
    /* ‰øùÊåÅÂè•Â≠êÂÜÖËÅîÊòæÁ§∫ */
}

.highlight-sentence {
    // background-color: rgba(255, 255, 0, 0.3);
    // transition: background-color 0.3s ease;
    color: gray;
    /* ËÆæÁΩÆÁÅ∞Ëâ≤Â≠ó‰Ωì */
}

.highlight-hover {
    // background-color: rgba(255, 255, 0, 0.6);
    background-color: lightgray;
    /* ËÆæÁΩÆ hover Êó∂ÁÅ∞ËÉåÊôØ */
    transition: background-color 0.2s ease;
    /* Ê∑ªÂä†Âπ≥ÊªëËøáÊ∏°ÊïàÊûú */
}

.highlight-icon {
    position: absolute;
    width: 32px;
    /* Á®çÂæÆÂä†Â§ßÂ∞∫ÂØ∏ */
    height: 32px;
    background-color: #ffeb3b;
    /* ‰ΩøÁî®Êõ¥ÊüîÂíåÁöÑÈªÑËâ≤ */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    /* Êõ¥Ê∑±ÁöÑÈò¥ÂΩ±ÔºåËÆ©ÊåâÈíÆÊúâÊµÆÂä®ÊïàÊûú */
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    /* Â¢ûÂä†‰∫§‰∫íÂä®Áîª */
    top: 0;
    left: 0;
}

.highlight-icon:hover {
    transform: scale(1.1);
    /* ÊÇ¨ÂÅúÊó∂ÊîæÂ§ß */
    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.3);
    /* ÊÇ¨ÂÅúÊó∂Êõ¥Ê∑±ÁöÑÈò¥ÂΩ± */
}

.highlight-icon span {
    font-weight: bold;
    color: #000000;
    /* ÈªëËâ≤Â≠ó‰ΩìÊõ¥Ê∏ÖÊô∞ */
    font-size: 18px;
    /* Ë∞ÉÊï¥ÊñáÂ≠óÂ§ßÂ∞è */
    user-select: none;
    /* Èò≤Ê≠¢ÈÄâ‰∏≠ÊñáÂ≠ó */
}

.highlight-icon:active {
    transform: scale(0.95);
    /* ÁÇπÂáªÊó∂Áï•ÂæÆÁº©Â∞è */
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
    /* ÁÇπÂáªÊó∂Èò¥ÂΩ±ÂèòÊµÖ */
}
</style>